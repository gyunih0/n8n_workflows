# Parnas 호텔 매출 집계 자동화 n8n 워크플로우

## 🌟 프로젝트 개요

이 프로젝트는 n8n 워크플로우를 활용하여 Parnas 호텔의 **월별 매출 집계, 데이터 분석 및 리포트 공유 프로세스를 자동화**하는 것을 목표로 합니다. 기존의 수동 작업을 자동화함으로써 업무 효율성을 극대화하고, 데이터 기반의 신속한 의사결정을 지원합니다.

## 🎯 프로젝트 목표

*   **매달 수기로 처리하고 있는 매출 집계 요청을 자동화**합니다.
*   집계 및 분석이 완료된 **매출 시트 내용을 담당자에게 자동으로 공유**하는 프로세스를 추가합니다.

## 🛠️ 기술 스택

*   **n8n:** 워크플로우 자동화 플랫폼.
*   **Parnas 호텔 API:** 매출 데이터 추출을 위한 내부 API.
*   **Google Sheets:** 매출 데이터 저장 및 관리를 위한 스프레드시트. 워크플로우는 `파르나스 매출 데이터` 시트를 업데이트합니다.
*   **Google Drive:** 분석된 Google Sheet 파일을 담당자에게 공유 하는 용도.
*   **Google Contacts:** 담당자 이메일 주소 조회를 위한 연락처 관리 서비스.
*   **AI Agent (LangChain):** Google Sheet 데이터 분석 및 요약 리포트 생성을 위한 AI 연동.
*   **OpenAI Chat Model (GPT-4o):** AI Agent의 언어 모델로 활용됩니다.

## ✨ 워크플로우 주요 기능 (동작 순서)

이 워크플로우는 다음과 같은 순서로 Parnas 호텔의 매출 집계 및 공유 과정을 자동화합니다.

1.  **워크플로우 시작 트리거 설정:**
    *   워크플로우는 **매달 1일 오전 9시**에 자동으로 실행되도록 스케줄링되어 있습니다.

2.  **Parnas 호텔 API 연동 및 데이터 추출:**
    *   **Access Token 획득:** 로그인 정보를 이용하여 API 호출에 필요한 Access Token을 획득합니다.
    *   **예약 목록 조회:** 체크아웃 날짜를 기준으로 예약 완료된 전월 예약 데이터를 조회하기 위해 Parnas 호텔 예약 목록 API를 호출하여 예약 데이터를 조회합니다.
    *   **데이터 추출 및 집계:** `Split Out` 노드를 통해 추출된 예약 목록 (`content` 필드) 에서 `hotelName`, `checkOutDate`, `membershipNo`, `totalPrice` 등의 핵심 데이터를 추출합니다. 이 데이터는 `매출 구하기` 노드를 거쳐 실제 매출이 계산되며, 여러 `Aggregate` 노드를 통해 호텔, 월, 회원 여부별로 매출을 집계합니다.

3.  **Google Sheet 연동 및 AI 분석/요약:**
    *   **매출 데이터 업데이트:** 추출 및 집계된 매출 데이터를 `파르나스 매출 데이터` Google Sheet에 **`분류`**, **`매출`** 등의 필드를 포함하여 `appendOrUpdate` 작업으로 추가하거나 업데이트합니다.
    *   **AI Agent를 통한 분석 및 요약:** `AI Agent1` 노드와 `OpenAI Chat Model` (GPT-4o 모델)을 활용하여 업데이트된 Google Sheet의 매출 데이터를 분석하고 요약 리포트를 생성합니다. AI Agent는 현재 날짜를 기준으로 월별 매출 비교, 멤버/비멤버 판매 동향 (전체 판매 및 비율), 비멤버 비율이 높거나 낮은 호텔 하이라이트, 호텔별 전반적인 트렌드 (상위 3개 호텔, 성장률 상위 3개 호텔, 감소 추세 호텔) 등을 **반드시 한국어로** 요약합니다.

4.  **담당자에게 결과 공유:**
    *   **담당자 이메일 조회:** Google Contacts에서 담당자(예: '김호균')의 이메일 주소를 조회합니다.
    *   **Google Drive 파일 공유:** `AI Agent2` 노드와 Google Drive 연동을 통해 업데이트된 `파르나스 매출 데이터` Google Sheet 파일을 조회된 담당자 이메일 주소로 **읽기 권한**을 부여하여 공유하고 이메일 알림을 발송합니다.
    *   **매출 요약 리포트 이메일 발송:** `AI Agent2` 노드는 앞서 `AI Agent1`이 생성한 **`매출 요약 리포트`** 내용을 공유 이메일 본문에 직접 포함시켜 발송합니다. 이메일 내용은 **반드시 한국어**로 작성되며, 분석 내용과 Google Sheet 링크를 명확하게 포함합니다.

## 🚀 성과 및 향후 기대 효과

*   **업무 효율성 증대:** 매달 수기로 처리하던 매출 집계 및 보고 업무를 자동화하여 **인적 오류를 줄이고 시간을 크게 절약**할 수 있습니다.
*   **신속하고 정확한 의사결정 지원:** AI를 통한 데이터 분석 및 요약으로 **매출 트렌드에 대한 깊이 있는 인사이트를 빠르게 확보**하고, 이를 바탕으로 경영진의 신속하고 정확한 의사결정을 지원합니다.??? 


## 💡 개선 방향

*   **매출 분석 내용의 데이터 셋 구체화:** 현재 매출 분석 내용은 요구사항에 포함되지 않았으며, 필요한 정확한 데이터 셋을 알지 못해 예시로 작성되었습니다. 실제 적용 시에는 분석 목적에 맞는 데이터 처리 로직 및 데이터 셋을 추가적으로 정의하고 고도화해야 합니다.
*   **알림 채널 확장 검토:** 현재는 이메일 공유 프로세스가 포함되어 있으나, 추후 **Jira 티켓 등록 프로세스로 변경 가능할지 확인 및 구현 검토**가 필요합니다.