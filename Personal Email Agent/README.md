# 📧 개인 이메일 에이전트 워크플로우

## 🌟 프로젝트 개요
이 워크플로우는 **수신 이메일 자동화 처리 → AI 기반 카테고리 분류 → 일정 관리 연동 → 사용자 승인 → 캘린더 등록 및 자동 회신**까지 전 과정을 수행하는 **n8n 기반 개인 이메일 에이전트**입니다.  
Naver Mail과 Gmail에서 수신된 이메일을 트리거로 감지하여 **이메일 분류, 스팸 처리, 일정 요청 처리**를 자동화합니다. 일정 요청 메일의 경우 Google Calendar와 연동해 추천 가능한 일정 후보를 제시하고, Telegram을 통해 사용자 승인을 받은 뒤, 캘린더에 일정을 등록하고 초대 메일을 자동 발송합니다.

---

## 🎯 프로젝트 목표
1. **이메일 자동 분류**
   - OpenAI 기반 AI Agent를 활용해 스팸 / 일정 관리 / 일반 메일 자동 분류
   - 스팸일 경우 해당 메일함으로 즉시 이동

2. **일정 관리 자동화**
   - 일정 관련 메일을 감지하면 Google Calendar 일정 조회
   - 충돌 여부를 확인하고 3개의 추천 일정 후보를 자동 생성

3. **사용자 승인 기반 처리**
   - Telegram 알림을 통해 추천 일정을 사용자에게 전달
   - 사용자가 승인 시 캘린더에 등록 및 초대 메일 발송

4. **자동 회신**
   - 일정 등록 후 Gmail API를 통해 회신 메일 전송
   - 초대 링크와 확정된 일정 정보를 포함하여 사용자와 송신자 모두에게 안내

---

## 🛠️ 기술 스택
- **n8n**: 자동화 워크플로우 엔진 (self-hosted)
- **Naver Mail IMAP / Gmail IMAP**: 이메일 트리거, 스팸 처리
- **OpenAI (GPT-4.1-mini / GPT-4o)**: 이메일 카테고리 분류 및 일정 분석
- **Google Calendar API**: 일정 조회(Cal-Read), 일정 등록(Cal-Write)
- **Telegram Bot**: 사용자 승인/선택 인터페이스
- **Gmail API**: 일정 확정 후 회신 메일 자동 발송

---

## 📊 워크플로우 개요
![img](https://github.com/gyunih0/n8n_workflows/blob/main/Personal%20Email%20Agent/Workflow%20Image.png?raw=true)

---

## ⚙️ 워크플로우 동작 순서

### 1. 이메일 수신
- `NaverMail Trigger (IMAP)`, `Gmail Trigger (IMAP)`를 통해 신규 메일 감지
- 메일 필드(subject, text, from, uid 등) 추출

### 2. AI 기반 분류
- OpenAI Chat Model + Structured Output Parser 사용
- `category`: spam | meeting | normal
- 분류 이유(reason)를 JSON 구조로 출력


### 3. 스팸 처리 플로우
**스팸 처리**
- Naver 메일일 경우 → Junk[스팸] 폴더 이동
- Gmail 메일일 경우 → [Gmail]/스팸함 이동


### 4. 일정 처리 플로우
4-1. **일정 메일 분석**
   - `AI Agent`가 메일 제목/본문 분석 → 요청된 일자·시간 추출
   - `Cal-Read`로 해당 날짜의 내 일정 전체 조회 및 요약
   - 충돌 여부를 확인하고 추천 일정 3가지 생성

4-2. **사용자 승인 (Human Validation)**
   - Telegram 메시지로 요청 메일 요약, 기존 일정, 추천 일정 전달
   - 사용자가 직접 승인/선택 → `IfConfirmed` 노드로 분기

4-3. **일정 확정 및 회신**
   - 승인된 일정은 `Cal-Write`를 통해 Google Calendar에 등록
   - 초대 링크 포함 회신 메일을 Gmail API로 자동 발송
   - 회신 메일 제목은 `[Re]` 접두어와 요약된 일정 내용을 포함

---

## 🚀 성과 및 기대 효과
- **자동화된 메일 관리**: 스팸·일정·일반 메일 분류로 메일 처리 시간 절감
- **일정 충돌 방지**: 기존 캘린더 일정과 자동 비교하여 충돌 없는 추천 일정 제공
- **사용자 중심 승인**: Telegram 기반 선택형 인터페이스로 직관적인 일정 확정  
  → 사용자가 직접 승인을 수행함으로써 **일정 등록 과정에 대한 명확한 인지**가 가능하고, **여러 후보 중 원하는 시간 선택**이 가능함  
  → 단순 자동화가 아닌 **휴먼 밸리데이션(Human Validation)** 과정이 포함되어 **일정 확정 안정성**이 크게 향상됨
- **완전 자동화**: 일정 등록부터 회신 메일 발송까지 무인 자동화 처리 가능

---

## 💡 배운 점 및 개선 방향
### 한계점
- **분류 정확도 의존성**: AI 분류 모델 성능에 따라 스팸/일정 구분 오류 가능
- **Telegram 의존성**: 승인 프로세스가 Telegram 계정 사용 전제
- **단일 캘린더 제한**: 현재 Google Calendar 하나에만 등록 가능
- **자동 회신 어색함**: 일정 확정 메일이 다소 기계적이며, 다른 일정에 대한 의견을 물어보는 등 자연스럽지 못한 표현 존재
- **멀티 이메일 계정 부족**: 여러 이메일 계정을 동시에 다루기엔 제한적 (예: Naver에서 요청했지만 답변은 Gmail로만 전송되는 문제)

### 개선 방향
- **카테고리 확장**: 업무 요청, 결제/영수증, 뉴스레터 등 다양한 분류 추가
- **다채널 알림**: Slack, Discord, Teams 등 추가 협업 툴 지원
- **스마트 학습**: 사용자 피드백 기반으로 카테고리 분류 정확도 향상
- **캘린더 다중 지원**: 사내/개인 캘린더 연동 가능성 확대
- **미팅 초대 메일 처리**: 외부에서 오는 Google/Outlook 등 미팅 초대 메일도 동일한 Human Validation 프로세스를 거쳐 승인 및 등록 가능하도록 기능 확장

---
